@if (showHeader) {
  <div class="calendar-header">    
    <div class="left-controls">
      <mat-button-toggle-group [hideSingleSelectionIndicator]="true">
        <mat-button-toggle (click)="prev()" [matTooltip]="'SUGGESTION.HEADER.PREV' | translate"><mat-icon>keyboard_arrow_left</mat-icon></mat-button-toggle>
        <mat-button-toggle (click)="calendarComponent.getApi().today()" [matTooltip]="'SUGGESTION.HEADER.TODAY' | translate" aria-label="today">
          {{ 'SUGGESTION.HEADER.TODAY' | translate }}          
        </mat-button-toggle>
        <mat-button-toggle (click)="next()" [matTooltip]="'SUGGESTION.HEADER.NEXT' | translate"><mat-icon>keyboard_arrow_right</mat-icon></mat-button-toggle>        
      </mat-button-toggle-group>
    </div>

    <div class="current-date">
      {{ calendarsTitle }}
    </div>

    <div class="right-controls">
      <mat-button-toggle-group [hideSingleSelectionIndicator]="true">
        <mat-button-toggle (click)="changeView('listWeek')">{{ 'SUGGESTION.HEADER.LIST' | translate }}</mat-button-toggle>        
        <mat-button-toggle [checked]="true" (click)="changeView('timeGridWeek')">{{ 'SUGGESTION.HEADER.WEEK' | translate }}</mat-button-toggle>
        <mat-button-toggle (click)="changeView('dayGridMonth')">{{ 'SUGGESTION.HEADER.MONTH' | translate }}</mat-button-toggle>
      </mat-button-toggle-group>
    </div>
  </div>
}
<full-calendar
  #calendar
  [options]="calendarOptions"
  [events]="eventsPromise | async"
></full-calendar>

<!-- Template used to render FullCalendar list items via Angular bindings.
     Context variables provided from component: timeText, title, lang, types -->
<ng-template #eventListTemplate let-timeText="timeText" let-title="title" let-lang="lang" let-types="types">
  <div class="fc-list-item-container d-flex align-items-center" style="gap:6px;">
    <span class="fc-list-item-time" *ngIf="timeText">{{ timeText }}</span>
    <div class="fc-list-item-main d-flex align-items-center" style="gap:6px;">
      <span class="fc-list-item-title">{{ title }}</span>

      <ng-container *ngIf="lang">
        <img class="type-icon" style="height:18px; margin-left:6px" [matTooltip]="('LANGUAGES.' + lang) | translate" [src]="'/cal_images/flags/' + (lang | lowercase) + '.svg'" [alt]="('LANGUAGES.' + lang) | translate" />
      </ng-container>

      <ng-container *ngIf="types && types.length">
        <ng-container *ngFor="let t of types">
          <img class="type-icon" style="height:18px; margin-left:6px" [matTooltip]="t | translate" [src]="'/cal_images/types/' + (t | lowercase) + '.png'" [alt]="t | translate" />
        </ng-container>
      </ng-container>
    </div>
  </div>
</ng-template>

<!-- Hidden anchor where the component will create embedded views from the template -->
<ng-template #eventListTemplateContainer></ng-template>

@if (showFooter && (editable || suggestible)) {
  @if (suggestible && (changes.size != 0 || deletedMasses.length != 0)) {
    <div class="footer suggestion-footer">
      <div class="sender-data">
        <mat-form-field>
          <mat-label>{{ 'SUGGESTION.SENDER.NAME' | translate }}</mat-label>
          <input matInput [formControl]="suggestionSenderName" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>{{ 'SUGGESTION.SENDER.EMAIL' | translate }}</mat-label>
          <input matInput [formControl]="suggestionSenderEmail" />
        </mat-form-field>
      </div>
      <div class="buttons">
        <button mat-flat-button="tonal" (click)="onResetCalendar()"> {{ 'CANCEL' | translate }}</button>
        <button mat-flat-button (click)="onSendToApprove()">{{ 'SEND_TO_APPROVE' | translate }}</button>
      </div>
    </div>
  } @else if (editable && (deletedMasses.length > 0 || changes.size > 0)) {
    <div class="footer">
      <div class="buttons">
        <button mat-flat-button (click)="onResetCalendar()"> {{ 'CANCEL' | translate }}</button>
        <button mat-flat-button (click)="onSaveCalendar()">{{ 'SAVE' | translate }}</button>
      </div>
    </div>
  }
}


@if (showMassListInEdit) {
  <div class="mass-list mt-3">
    <h3>Misék listája</h3>
    <div *ngFor="let group of massListGrouped">
      <h4 class="d-flex align-items-center">        
        <div>
          <span *ngIf="group.color" class="badge period-color-badge" [style.backgroundColor]="group.color">{{ group.color }}</span> 
           <strong>{{ group.periodName }}</strong>
          <div class="text-muted small">            
            <ng-container *ngIf="group.startMonthDay || group.startPeriodName || group.endMonthDay || group.endPeriodName">
              <span *ngIf="group.startMonthDay || group.startPeriodName" style="font-weight: normal;">
                {{ group.startPeriodName ? group.startPeriodName : group.startMonthDay }}
              </span>
              -
              <span *ngIf="group.endMonthDay || group.endPeriodName" style="font-weight: normal;">
                {{ group.endPeriodName ? group.endPeriodName : group.endMonthDay }}
              </span>
            </ng-container>
          </div>
        </div>
      </h4>
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>Start</th>
              <th>Title</th>
              <th>Rite</th>
              <th>Icons</th>
              <th>Edit</th>
              <th>Kizárt időszakok</th>
              <th>Comment</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of group.masses">
              <td>{{ m.startDate | date:'HH:mm' }}</td>
              <td>
                <span class="mass-list-title">{{m.title}}</span>
                <div *ngIf="m.readableRRule" class="text-muted small">{{m.readableRRule}}</div>
              </td>
              <td>{{m.rite | translate }}</td>
              <td>
                <ng-container *ngFor="let t of m.types">
                  <img class="type-icon" style="height:18px; margin-left:6px" [matTooltip]="t | translate" [src]="'/cal_images/types/' + t.toLowerCase() + '.png'" [alt]="t | translate" />
                </ng-container>
                <img class="type-icon" style="height:18px; margin-left:6px" [matTooltip]="(('LANGUAGES.' + m.lang) | translate) + ' nyelvű'" [src]="'/cal_images/flags/' + m.lang.toLowerCase() + '.svg'" [alt]="(('LANGUAGES.' + m.lang) | translate) + ' nyelvű'" />
              </td>
              <td>
                <button mat-icon-button (click)="openMassFromList(m)" [matTooltip]="'EDIT' | translate" aria-label="edit">
                  <mat-icon>edit</mat-icon>
                </button>
              </td>
              <td>
                <div *ngIf="m.experiodNames && m.experiodNames.length" class="text-muted small">
                  <ng-container *ngFor="let e of m.experiodNames; let i = index">
                    {{ e }}<span *ngIf="i < m.experiodNames.length - 1">, </span>
                  </ng-container>
                </div>
              </td>
              <td>{{m.comment}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
}